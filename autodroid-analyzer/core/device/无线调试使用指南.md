# AutoDroid 无线调试功能使用指南

## 📱 功能概述

AutoDroid 设备管理器现已支持无线调试功能，允许您通过WiFi网络连接Android设备进行调试，无需USB连接。

## 🔧 前置条件

1. **设备要求**
   - Android 设备已开启 USB 调试模式
   - 设备和电脑连接到同一 WiFi 网络
   - 设备已通过 USB 连接并授权调试

2. **环境要求**
   - ADB 工具已安装并配置到 PATH
   - Python 3.6+
   - 网络连接稳定

## 🚀 快速开始

### 方法一：使用测试脚本

```bash
# 进入设备目录
cd /d/git/autodroid/autodroid-analyzer/device

# 运行测试脚本
python test_wireless_debugging.py
```

测试脚本会自动：
- 检测已连接的设备
- 显示设备信息
- 开启无线调试
- 验证连接状态
- 提供使用指南

### 方法二：在代码中使用

```python
from device_manager import DeviceManager

# 创建设备管理器实例
device_manager = DeviceManager("设备ID")

# 开启无线调试
result = device_manager.enable_wireless_debugging(port=5555)

if result["success"]:
    print(f"无线调试开启成功: {result['wireless_address']}")
    
    # 断开USB连接后，可以继续使用无线调试
    # 例如执行shell命令
    device_manager.shell("pm list packages")
else:
    print(f"开启失败: {result.get('error', '未知错误')}")
```

## 📋 详细使用说明

### 1. 首次开启无线调试

**重要提示：请先通过USB连接设备！**

```python
# 必须通过USB连接设备才能首次开启无线调试
device_manager = DeviceManager("USB设备ID")

# 开启无线调试
result = device_manager.enable_wireless_debugging()
```

### 2. 检查无线连接状态

```python
# 检查特定设备的无线连接状态
is_connected = device_manager.is_wireless_connected("192.168.1.32", 5555)

if is_connected:
    print("无线连接正常")
else:
    print("无线连接已断开")
```

### 3. 断开无线连接

```python
# 断开无线连接
device_manager.disconnect_wireless("192.168.1.32", 5555)
```

### 4. 多设备管理

```python
# 为不同设备使用不同端口
device1 = DeviceManager("设备1ID")
device2 = DeviceManager("设备2ID")

# 使用不同端口避免冲突
result1 = device1.enable_wireless_debugging(port=5555)
result2 = device2.enable_wireless_debugging(port=5556)
```

## 🔍 故障排除

### 常见问题

1. **无法获取设备IP地址**
   - 检查设备是否连接到WiFi
   - 确认设备和电脑在同一网络
   - 尝试重启设备网络连接

2. **无线连接失败**
   - 检查防火墙设置
   - 确认端口未被占用
   - 检查网络稳定性

3. **连接后操作无响应**
   - 检查设备是否进入休眠
   - 确认无线信号强度
   - 尝试重新连接

### 调试命令

```bash
# 检查设备连接状态
adb devices

# 检查网络连接
adb shell ping -c 4 8.8.8.8

# 查看设备IP地址
adb shell ip addr show wlan0
```

## 💡 最佳实践

1. **端口管理**
   - 为每个设备分配唯一端口
   - 常用端口范围：5555-5580
   - 避免使用系统保留端口

2. **连接稳定性**
   - 保持设备屏幕常亮
   - 使用稳定的WiFi网络
   - 定期检查连接状态

3. **安全考虑**
   - 仅在可信网络中使用
   - 调试完成后及时断开
   - 避免在生产环境开启

## 📊 功能特性

- ✅ 自动检测设备IP地址
- ✅ 支持多设备同时调试
- ✅ 详细的错误提示和指南
- ✅ 连接状态监控
- ✅ 安全断开连接
- ✅ 兼容现有USB调试功能

## ❓ 常见问题解答

### Q: 无线调试打开后，可以关闭USB调试吗？

**A: 不可以关闭USB调试。**

#### 🔧 技术原理说明

无线调试功能实际上是**基于USB调试模式**的扩展功能：

1. **首次授权必须通过USB**：无线调试需要先在设备上通过USB连接进行授权
2. **USB调试是基础**：无线调试只是将USB调试的通信通道从USB线改为WiFi网络
3. **USB调试开关必须保持开启**：如果关闭USB调试，无线调试也会立即失效

#### 📱 实际使用场景

**正确的做法是：**
- 保持USB调试模式开启
- 通过无线调试连接后，可以**断开USB线**，但不要关闭USB调试开关
- 设备会继续通过WiFi网络与电脑通信

#### ⚠️ 重要提醒

如果您在设备设置中关闭了"USB调试"开关，会发生以下情况：
- 无线调试连接会立即断开
- 需要重新通过USB连接并重新授权
- 无法再通过WiFi进行调试

#### 💡 最佳实践

```python
# 正确的使用流程
from device_manager import DeviceManager

# 1. 通过USB连接设备（USB调试必须开启）
device_manager = DeviceManager("设备ID")

# 2. 开启无线调试
result = device_manager.enable_wireless_debugging()

# 3. 现在可以安全断开USB线
#   但不要关闭设备上的USB调试开关！

# 4. 继续通过无线进行调试
device_manager.shell("pm list packages")
```

#### 🔄 重新连接

如果无线连接断开，需要重新连接时：
1. **不需要重新开启USB调试**（只要开关保持开启）
2. 可能需要重新运行无线调试连接命令
3. 或者重新插拔USB线进行授权

**总结：无线调试开启后，可以断开USB线，但必须保持设备上的USB调试开关开启状态。**

## 🆘 技术支持

如果遇到问题，请检查：

1. 设备USB调试是否开启
2. 设备和电脑网络连接
3. ADB工具版本和配置
4. Python环境依赖

如需进一步帮助，请查看设备日志或联系开发团队。

---

**注意：无线调试功能需要设备通过USB首次授权，之后可在同一网络下无线使用。**
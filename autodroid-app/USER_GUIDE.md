# Autodroid 服务器发现功能使用指南

## 概述

Autodroid应用提供了三种简单的方式来发现和连接服务器：
- **自动mDNS发现**：自动搜索网络中的Autodroid服务器
- **QR码扫描**：扫描服务器生成的QR码快速连接
- **手动输入**：手动输入服务器地址进行连接

## 功能特性

### 1. 自动mDNS发现
- **功能**：自动搜索局域网内的Autodroid服务器
- **重试机制**：支持失败自动重试，最多3次
- **状态显示**：实时显示发现进度和重试次数

### 2. QR码扫描
- **功能**：扫描服务器生成的QR码快速连接
- **权限管理**：自动请求相机权限
- **格式验证**：自动验证QR码格式有效性

### 3. 手动输入
- **功能**：手动输入服务器API端点进行连接
- **格式验证**：验证输入的API端点格式
- **类型安全**：使用类型化API确保数据安全

## 使用步骤

### 方法一：自动mDNS发现（推荐）

1. **启动应用**：打开Autodroid应用
2. **等待发现**：应用会自动开始mDNS发现
3. **查看状态**：
   - "Discovering servers via mDNS..." - 正在搜索
   - "mDNS Discovery (Retry X)..." - 第X次重试
   - "mDNS Discovery Successful" - 发现成功
4. **自动连接**：发现成功后自动连接服务器

### 方法二：QR码扫描

1. **点击QR按钮**：在服务器连接卡片中点击QR码图标
2. **授权相机**：允许应用使用相机权限
3. **扫描QR码**：对准服务器生成的QR码进行扫描
4. **自动连接**：扫描成功后自动连接服务器

### 方法三：手动输入

1. **点击手动输入按钮**：在服务器连接卡片中点击手动输入图标
2. **输入API端点**：在对话框中输入服务器地址，例如：
   - `http://192.168.1.100:8000/api`
   - `https://myserver.com:8000/api`
3. **点击连接**：系统会自动验证并连接服务器

## 状态指示

### 连接状态
- **DISCOVERING**：正在发现服务器
- **DISCOVERED**：服务器已发现
- **CONNECTED**：已连接到服务器
- **READY**：服务器健康，准备就绪
- **HEALTH_CHECK_FAILED**：服务器健康检查失败
- **ERROR**：连接过程中出现错误

### 按钮状态
- **启用**（绿色）：可以点击使用
- **禁用**（灰色）：当前不可用（如发现进行中）

## 错误处理

### 常见错误及解决方案

1. **mDNS发现失败**
   - **原因**：网络问题或服务器未启动
   - **解决方案**：
     - 检查网络连接
     - 确认服务器已启动
     - 尝试手动输入或QR码扫描

2. **QR码扫描失败**
   - **原因**：QR码格式错误或相机权限问题
   - **解决方案**：
     - 检查QR码是否为有效的Autodroid服务器QR码
     - 确认已授予相机权限
     - 尝试手动输入

3. **手动连接失败**
   - **原因**：API端点格式错误或服务器不可达
   - **解决方案**：
     - 检查API端点格式（必须以http://或https://开头）
     - 确认服务器地址和端口正确
     - 检查网络连接

## 高级功能

### 重试机制
- mDNS发现支持自动重试，最多3次
- 每次重试间隔时间递增
- 重试次数显示在状态信息中

### 类型安全API
- 所有API调用都使用类型化数据模型
- 确保数据传输的安全性和一致性
- 自动验证服务器响应格式

### 实时状态更新
- 实时显示连接进度
- 详细的错误信息提示
- 友好的用户反馈消息

## 最佳实践

1. **网络环境**：确保设备和服务器在同一局域网内
2. **服务器配置**：确认服务器已正确配置并启动
3. **权限管理**：首次使用QR码扫描时授权相机权限
4. **故障排除**：如遇问题，按顺序尝试三种连接方式

## 技术支持

如遇到问题，请检查：
- 网络连接状态
- 服务器运行状态
- 应用权限设置
- 错误日志信息

如需进一步帮助，请联系技术支持团队。